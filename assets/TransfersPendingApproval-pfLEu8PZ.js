import{d as pe,u as _e,r as l,o as he,w as G,y as P,e as i,f as e,h as p,t as o,G as C,b as z,l as N,v as J,I as O,F as fe,C as be,n as v,J as ge,i as me,X as ke,T as ye,m as Q,q as d,s as Ce}from"./index-DKx7ZiZy.js";import{T as V,S as we}from"./TransfersFlowService-CrKQ_05Z.js";import{C as je}from"./check-D82HTsTF.js";const xe={class:"toolbar"},Re={class:"page-title"},Te={class:"toolbar-right"},Pe={class:"search-container"},Ae=["placeholder"],Me={key:0,class:"selection-bar"},qe={class:"selection-info"},Se={class:"action-buttons"},$e=["disabled"],De=["disabled"],Le={key:1,class:"loading-container"},Ie={key:2,class:"table-container"},Be={key:"head"},Ee={class:"checkbox-column"},Fe={class:"checkbox-container"},Ne=["checked"],Ve={style:{"text-align":"center"}},Ue={style:{"text-align":"center"}},He={style:{"text-align":"center"}},Ge={style:{"text-align":"center"}},ze={style:{"text-align":"center"}},Je={style:{"text-align":"center"}},Oe={key:"body"},Qe={class:"checkbox-column"},Xe={class:"checkbox-container"},Ke=["onChange","checked"],We={class:"code-cell"},Ye={class:"action-buttons-cell"},Ze=["onClick"],ea=["onClick"],aa={key:"no-results"},ta={colspan:"7",class:"no-results"},sa={class:"pagination"},oa=["disabled"],na={class:"page-info"},la=["disabled"],ra={class:"modal-header"},ca={class:"modal-body"},ua={key:0,class:"reason-container"},ia={for:"rejection-reason",class:"reason-label"},da=["placeholder"],va={key:0,class:"reason-error"},pa={class:"modal-footer"},_a=["disabled"],ha={class:"modal-header"},fa={class:"modal-body"},ba={class:"modal-footer"},X=10,ga=pe({name:"TransfersPendingApprovalPage",__name:"TransfersPendingApproval",setup(ma){const w=_e(),s=l(!1),f=l(!1);he(()=>{s.value=w.language==="ar",f.value=w.darkMode,_()}),G(()=>w.language,t=>s.value=t==="ar"),G(()=>w.darkMode,t=>f.value=t);const K={stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"},W={stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},b=P(()=>s.value?W:K),A=l([]),M=l(0),q=l(!1),j=l(!1),S=l(""),x=l(!1);function Y(t){return{pending:s.value?"قيد الانتظار":"Pending","under-review":s.value?"قيد المراجعة":"Under Review",approved:s.value?"تمت الموافقة":"Approved",rejected:s.value?"تم الرفض":"Rejected"}[t.toLowerCase()]||t}function Z(t){try{const a=new Date(t);return new Intl.DateTimeFormat(s.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)}catch{return t}}const r=l([]),ee=P(()=>k.value.length>0&&r.value.length===k.value.length);function $(t){return r.value.some(a=>a.transaction_id===t.transaction_id)}function ae(t){$(t)?r.value=r.value.filter(a=>a.transaction_id!==t.transaction_id):r.value.push(t)}function te(t){t.target.checked?r.value=[...k.value]:r.value=[]}function se(t){const a=t.toLowerCase();return a==="approved"?"row-approved":a==="rejected"?"row-rejected":a==="under-review"?"row-review":"row-pending"}const g=l(""),c=l(1),D=l(null);function oe(){D.value&&clearTimeout(D.value),D.value=window.setTimeout(()=>{c.value=1,_()},500)}function ne(){g.value="",c.value=1,_()}async function _(){try{q.value=!0;const t=await V.fetchPendingTransfers(c.value,X,g.value,"FAR");A.value=(t.results||[]).map(a=>({transaction_id:a.id||a.transaction_id,status:a.status,code:a.transfer_id||a.code||"",request_date:a.created_at||a.request_date||"",requested_by:a.user_name||a.requested_by||"",transaction_date:a.updated_at||a.transaction_date||""})),M.value=t.count||0,r.value=[]}catch(t){console.error("Failed to load transfers:",t),S.value=s.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",x.value=!0,A.value=[],M.value=0}finally{q.value=!1}}function le(){c.value<m.value&&(c.value++,_())}function re(){c.value>1&&(c.value--,_())}const m=P(()=>Math.ceil(M.value/X)),k=P(()=>A.value);function ce(t){R("approve",[t])}function ue(t){R("reject",[t])}function ie(){R("approve",r.value)}function de(){R("reject",r.value)}const L=l(!1),h=l("approve"),I=l(""),B=l(""),U=l([]),y=l(""),E=l(!1);function R(t,a){h.value=t,U.value=a,y.value="",E.value=!1;const u=a.length;t==="approve"?(I.value=s.value?"تأكيد الموافقة":"Confirm Approval",B.value=s.value?`هل أنت متأكد من موافقتك على ${u} من المناقلات؟`:`Are you sure you want to approve ${u} transfer request${u===1?"":"s"}?`):(I.value=s.value?"تأكيد الرفض":"Confirm Rejection",B.value=s.value?`هل أنت متأكد من رفضك لـ ${u} من المناقلات؟`:`Are you sure you want to reject ${u} transfer request${u===1?"":"s"}?`),L.value=!0}function T(){L.value=!1}function F(){x.value=!1}async function ve(){if(h.value==="reject"&&!y.value.trim()){E.value=!0;return}try{j.value=!0;const t=h.value,u=U.value.map(n=>n.transaction_id);if(t==="approve")await V.approveRejectTransfers(u,2);else{const n=u.map(()=>y.value.trim());await V.approveRejectTransfers(u,3,n)}await _(),T()}catch(t){console.error("Error processing action:",t),S.value=s.value?"حدث خطأ أثناء معالجة الإجراء. يرجى المحاولة مرة أخرى.":"An error occurred while processing your action. Please try again.",x.value=!0}finally{j.value=!1}}return(t,a)=>{const u=ge("router-link");return d(),i("div",{class:v(["approval-page",{"dark-mode":f.value}])},[e("div",xe,[e("h1",Re,o(s.value?"المناقلات قيد الاعتماد":"Transfers Pending Approval"),1),e("div",Te,[e("div",Pe,[C(N(we),{class:"search-icon"}),z(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>g.value=n),type:"search",placeholder:s.value?"بحث...":"Search...",class:"input-search",onInput:oe},null,40,Ae),[[J,g.value]]),g.value?(d(),i("button",{key:0,onClick:ne,class:"clear-search"},"×")):p("",!0)])])]),r.value.length>0?(d(),i("div",Me,[e("span",qe,o(s.value?`تم اختيار ${r.value.length} عنصر`:`${r.value.length} items selected`),1),e("div",Se,[e("button",{onClick:de,class:"btn-reject",disabled:r.value.length===0},o(s.value?"رفض":"Reject"),9,$e),e("button",{onClick:ie,class:"btn-approve",disabled:r.value.length===0},o(s.value?"موافقة":"Approve"),9,De)])])):p("",!0),q.value?(d(),i("div",Le,[a[4]||(a[4]=e("div",{class:"loader"},null,-1)),e("p",null,o(s.value?"جاري التحميل...":"Loading..."),1)])):(d(),i("div",Ie,[C(ye,{name:"table-fade",tag:"table",class:"main-table"},{default:O(()=>[e("thead",Be,[e("tr",null,[e("th",Ee,[e("label",Fe,[e("input",{type:"checkbox",onChange:te,checked:ee.value},null,40,Ne),a[5]||(a[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",Ve,o(b.value.stateLevel),1),e("th",Ue,o(b.value.code),1),e("th",He,o(b.value.requestDate),1),e("th",Ge,o(b.value.requestedBy),1),e("th",ze,o(b.value.transactionDate),1),e("th",Je,o(s.value?"إجراءات":"Actions"),1)])]),e("tbody",Oe,[(d(!0),i(fe,null,be(k.value,n=>(d(),i("tr",{key:n.transaction_id,class:v([[se(n.status),{"row-selected":$(n)}],"table-row"])},[e("td",Qe,[e("label",Xe,[e("input",{type:"checkbox",onChange:H=>ae(n),checked:$(n)},null,40,Ke),a[6]||(a[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,[e("span",{class:v(["status-badge","status-"+n.status.toLowerCase()])},o(Y(n.status)),3)]),e("td",We,[C(u,{to:`/cost-center-transfer/${n.transaction_id}?viewOnly=true`,class:"code-link"},{default:O(()=>[me(o(n.code),1)]),_:2},1032,["to"])]),e("td",null,o(Z(n.request_date)),1),e("td",null,o(n.requested_by),1),e("td",null,o(n.transaction_date),1),e("td",null,[e("div",Ye,[e("button",{class:"icon-btn approve-btn",onClick:H=>ce(n),title:"Approve"},[C(N(je))],8,Ze),e("button",{class:"icon-btn reject-btn",onClick:H=>ue(n),title:"Reject"},[C(N(ke))],8,ea)])])],2))),128)),k.value.length===0?(d(),i("tr",aa,[e("td",ta,o(s.value?"لا توجد نتائج":"No results found"),1)])):p("",!0)])]),_:1})])),e("div",sa,[e("button",{onClick:re,class:v(["page-btn",{disabled:c.value===1}]),disabled:c.value===1},o(s.value?"السابق":"Previous"),11,oa),e("span",na,o(s.value?`صفحة ${c.value} من ${m.value}`:`Page ${c.value} of ${m.value}`),1),e("button",{onClick:le,class:v(["page-btn",{disabled:c.value>=m.value}]),disabled:c.value>=m.value},o(s.value?"التالي":"Next"),11,la)]),L.value?(d(),i("div",{key:3,class:"modal-overlay",onClick:T},[e("div",{class:v(["modal-container",{"dark-mode":f.value}]),onClick:a[2]||(a[2]=Q(()=>{},["stop"]))},[e("div",ra,[e("h2",null,o(I.value),1),e("button",{class:"close-modal",onClick:T},"×")]),e("div",ca,[e("p",null,o(B.value),1),h.value==="reject"?(d(),i("div",ua,[e("label",ia,o(s.value?"سبب الرفض:":"Rejection Reason:"),1),z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":a[1]||(a[1]=n=>y.value=n),placeholder:s.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,da),[[J,y.value]]),E.value?(d(),i("p",va,o(s.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):p("",!0)])):p("",!0)]),e("div",pa,[e("button",{class:"btn-secondary",onClick:T},o(s.value?"إلغاء":"Cancel"),1),e("button",{class:v(h.value==="approve"?"btn-approve":"btn-reject"),onClick:ve,disabled:j.value},o(j.value?s.value?"جاري المعالجة...":"Processing...":h.value==="approve"?s.value?"موافقة":"Approve":s.value?"رفض":"Reject"),11,_a)])],2)])):p("",!0),x.value?(d(),i("div",{key:4,class:"modal-overlay",onClick:F},[e("div",{class:v(["modal-container error-modal",{"dark-mode":f.value}]),onClick:a[3]||(a[3]=Q(()=>{},["stop"]))},[e("div",ha,[e("h2",null,o(s.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:F},"×")]),e("div",fa,[e("p",null,o(S.value),1)]),e("div",ba,[e("button",{class:"btn-secondary",onClick:F},o(s.value?"إغلاق":"Close"),1)])],2)])):p("",!0)],2)}}}),wa=Ce(ga,[["__scopeId","data-v-50ea2670"]]);export{wa as default};
