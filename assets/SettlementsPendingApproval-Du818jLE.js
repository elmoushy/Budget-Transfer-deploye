import{d as pe,u as _e,r as l,o as he,w as O,y as S,e as u,f as e,h as p,t as o,G as _,b as z,l as A,v as J,I as N,F as fe,C as be,n as v,J as me,i as ge,X as ke,T as ye,m as Q,p as Ce,q as d,s as we}from"./index-DKx7ZiZy.js";import{T as U,S as je}from"./TransfersFlowService-CrKQ_05Z.js";import{E as Re}from"./eye-CqvhAtqx.js";import{C as xe}from"./check-D82HTsTF.js";const Pe={class:"toolbar"},Se={class:"page-title"},Ae={class:"toolbar-right"},Me={class:"search-container"},Te=["placeholder"],qe={key:0,class:"selection-bar"},$e={class:"selection-info"},De={class:"action-buttons"},Le=["disabled"],Ie=["disabled"],Be={key:1,class:"loading-container"},Ee={key:2,class:"table-container"},Ve={key:"head"},Fe={class:"checkbox-column"},Ne={class:"checkbox-container"},Ue=["checked"],He={style:{"text-align":"center"}},Ge={style:{"text-align":"center"}},Oe={style:{"text-align":"center"}},ze={style:{"text-align":"center"}},Je={style:{"text-align":"center"}},Qe={style:{"text-align":"center"}},Xe={key:"body"},Ke={class:"checkbox-column"},We={class:"checkbox-container"},Ye=["onChange","checked"],Ze={class:"code-cell"},et={class:"action-buttons-cell"},tt=["onClick"],at=["onClick"],st={key:"no-results"},ot={colspan:"7",class:"no-results"},nt={class:"pagination"},lt=["disabled"],rt={class:"page-info"},ct=["disabled"],it={class:"modal-header"},ut={class:"modal-body"},dt={key:0,class:"reason-container"},vt={for:"rejection-reason",class:"reason-label"},pt=["placeholder"],_t={key:0,class:"reason-error"},ht={class:"modal-footer"},ft=["disabled"],bt={class:"modal-header"},mt={class:"modal-body"},gt={class:"modal-footer"},X=10,kt=pe({name:"SettlementsPendingApprovalPage",__name:"SettlementsPendingApproval",setup(yt){const w=_e();Ce();const s=l(!1),b=l(!1);he(()=>{s.value=w.language==="ar",b.value=w.darkMode,h()}),O(()=>w.language,a=>s.value=a==="ar"),O(()=>w.darkMode,a=>b.value=a);const K={stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"},W={stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},m=S(()=>s.value?W:K),M=l([]),T=l(0),q=l(!1),j=l(!1),$=l(""),R=l(!1);function Y(a){return{pending:s.value?"قيد الانتظار":"Pending","under-review":s.value?"قيد المراجعة":"Under Review",approved:s.value?"تمت الموافقة":"Approved",rejected:s.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function Z(a){try{const t=new Date(a);return new Intl.DateTimeFormat(s.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}const r=l([]),ee=S(()=>y.value.length>0&&r.value.length===y.value.length);function D(a){return r.value.some(t=>t.transaction_id===a.transaction_id)}function te(a){D(a)?r.value=r.value.filter(t=>t.transaction_id!==a.transaction_id):r.value.push(a)}function ae(a){a.target.checked?r.value=[...y.value]:r.value=[]}function se(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const g=l(""),c=l(1),L=l(null);function oe(){L.value&&clearTimeout(L.value),L.value=window.setTimeout(()=>{c.value=1,h()},500)}function ne(){g.value="",c.value=1,h()}async function h(){try{q.value=!0;const a=await U.fetchPendingTransfers(c.value,X,g.value,"AFR");M.value=(a.results||[]).map(t=>({transaction_id:t.id||t.transaction_id,status:t.status,code:t.transfer_id||t.code||"",request_date:t.created_at||t.request_date||"",requested_by:t.user_name||t.requested_by||"",transaction_date:t.updated_at||t.transaction_date||""})),T.value=a.count||0,r.value=[]}catch(a){console.error("Failed to load transfers:",a),$.value=s.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",R.value=!0,M.value=[],T.value=0}finally{q.value=!1}}function le(){c.value<k.value&&(c.value++,h())}function re(){c.value>1&&(c.value--,h())}const k=S(()=>Math.ceil(T.value/X)),y=S(()=>M.value);function ce(a){x("approve",[a])}function ie(a){x("reject",[a])}function ue(){x("approve",r.value)}function de(){x("reject",r.value)}const I=l(!1),f=l("approve"),B=l(""),E=l(""),H=l([]),C=l(""),V=l(!1);function x(a,t){f.value=a,H.value=t,C.value="",V.value=!1;const i=t.length;a==="approve"?(B.value=s.value?"تأكيد الموافقة":"Confirm Approval",E.value=s.value?`هل أنت متأكد من موافقتك على ${i} من المناقلات؟`:`Are you sure you want to approve ${i} transfer request${i===1?"":"s"}?`):(B.value=s.value?"تأكيد الرفض":"Confirm Rejection",E.value=s.value?`هل أنت متأكد من رفضك لـ ${i} من المناقلات؟`:`Are you sure you want to reject ${i} transfer request${i===1?"":"s"}?`),I.value=!0}async function ve(){if(f.value==="reject"&&!C.value.trim()){V.value=!0;return}try{j.value=!0;const a=f.value,i=H.value.map(n=>n.transaction_id);if(a==="approve")await U.approveRejectTransfers(i,2);else{const n=i.map(()=>C.value.trim());await U.approveRejectTransfers(i,3,n)}await h(),P()}catch(a){console.error("Error processing action:",a),$.value=s.value?"حدث خطأ أثناء معالجة الإجراء. يرجى المحاولة مرة أخرى.":"An error occurred while processing your action. Please try again.",R.value=!0}finally{j.value=!1}}function P(){I.value=!1}function F(){R.value=!1}return(a,t)=>{const i=me("router-link");return d(),u("div",{class:v(["approval-page",{"dark-mode":b.value}])},[e("div",Pe,[e("h1",Se,o(s.value?"المناقلات قيد الاعتماد":"Transfers Pending Approval"),1),e("div",Ae,[e("div",Me,[_(A(je),{class:"search-icon"}),z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),type:"search",placeholder:s.value?"بحث...":"Search...",class:"input-search",onInput:oe},null,40,Te),[[J,g.value]]),g.value?(d(),u("button",{key:0,onClick:ne,class:"clear-search"},"×")):p("",!0)])])]),r.value.length>0?(d(),u("div",qe,[e("span",$e,o(s.value?`تم اختيار ${r.value.length} عنصر`:`${r.value.length} items selected`),1),e("div",De,[e("button",{onClick:de,class:"btn-reject",disabled:r.value.length===0},o(s.value?"رفض":"Reject"),9,Le),e("button",{onClick:ue,class:"btn-approve",disabled:r.value.length===0},o(s.value?"موافقة":"Approve"),9,Ie)])])):p("",!0),q.value?(d(),u("div",Be,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,o(s.value?"جاري التحميل...":"Loading..."),1)])):(d(),u("div",Ee,[_(ye,{name:"table-fade",tag:"table",class:"main-table"},{default:N(()=>[e("thead",Ve,[e("tr",null,[e("th",Fe,[e("label",Ne,[e("input",{type:"checkbox",onChange:ae,checked:ee.value},null,40,Ue),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",He,o(m.value.stateLevel),1),e("th",Ge,o(m.value.code),1),e("th",Oe,o(m.value.requestDate),1),e("th",ze,o(m.value.requestedBy),1),e("th",Je,o(m.value.transactionDate),1),e("th",Qe,o(s.value?"إجراءات":"Actions"),1)])]),e("tbody",Xe,[(d(!0),u(fe,null,be(y.value,n=>(d(),u("tr",{key:n.transaction_id,class:v([[se(n.status),{"row-selected":D(n)}],"table-row"])},[e("td",Ke,[e("label",We,[e("input",{type:"checkbox",onChange:G=>te(n),checked:D(n)},null,40,Ye),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,[e("span",{class:v(["status-badge","status-"+n.status.toLowerCase()])},o(Y(n.status)),3)]),e("td",Ze,[_(i,{to:`/cost-center-transfer/${n.transaction_id}?viewOnly=true`,class:"code-link"},{default:N(()=>[ge(o(n.code),1)]),_:2},1032,["to"])]),e("td",null,o(Z(n.request_date)),1),e("td",null,o(n.requested_by),1),e("td",null,o(n.transaction_date),1),e("td",null,[e("div",et,[_(i,{to:`/cost-center-settlement/${n.transaction_id}?viewOnly=true`,class:"icon-btn view-btn",title:"View Details"},{default:N(()=>[_(A(Re))]),_:2},1032,["to"]),e("button",{class:"icon-btn approve-btn",onClick:G=>ce(n),title:"Approve"},[_(A(xe))],8,tt),e("button",{class:"icon-btn reject-btn",onClick:G=>ie(n),title:"Reject"},[_(A(ke))],8,at)])])],2))),128)),y.value.length===0?(d(),u("tr",st,[e("td",ot,o(s.value?"لا توجد نتائج":"No results found"),1)])):p("",!0)])]),_:1})])),e("div",nt,[e("button",{onClick:re,class:v(["page-btn",{disabled:c.value===1}]),disabled:c.value===1},o(s.value?"السابق":"Previous"),11,lt),e("span",rt,o(s.value?`صفحة ${c.value} من ${k.value}`:`Page ${c.value} of ${k.value}`),1),e("button",{onClick:le,class:v(["page-btn",{disabled:c.value>=k.value}]),disabled:c.value>=k.value},o(s.value?"التالي":"Next"),11,ct)]),I.value?(d(),u("div",{key:3,class:"modal-overlay",onClick:P},[e("div",{class:v(["modal-container",{"dark-mode":b.value}]),onClick:t[2]||(t[2]=Q(()=>{},["stop"]))},[e("div",it,[e("h2",null,o(B.value),1),e("button",{class:"close-modal",onClick:P},"×")]),e("div",ut,[e("p",null,o(E.value),1),f.value==="reject"?(d(),u("div",dt,[e("label",vt,o(s.value?"سبب الرفض:":"Rejection Reason:"),1),z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),placeholder:s.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,pt),[[J,C.value]]),V.value?(d(),u("p",_t,o(s.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):p("",!0)])):p("",!0)]),e("div",ht,[e("button",{class:"btn-secondary",onClick:P},o(s.value?"إلغاء":"Cancel"),1),e("button",{class:v(f.value==="approve"?"btn-approve":"btn-reject"),onClick:ve,disabled:j.value},o(j.value?s.value?"جاري المعالجة...":"Processing...":f.value==="approve"?s.value?"موافقة":"Approve":s.value?"رفض":"Reject"),11,ft)])],2)])):p("",!0),R.value?(d(),u("div",{key:4,class:"modal-overlay",onClick:F},[e("div",{class:v(["modal-container error-modal",{"dark-mode":b.value}]),onClick:t[3]||(t[3]=Q(()=>{},["stop"]))},[e("div",bt,[e("h2",null,o(s.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:F},"×")]),e("div",mt,[e("p",null,o($.value),1)]),e("div",gt,[e("button",{class:"btn-secondary",onClick:F},o(s.value?"إغلاق":"Close"),1)])],2)])):p("",!0)],2)}}}),xt=we(kt,[["__scopeId","data-v-053ff0af"]]);export{xt as default};
