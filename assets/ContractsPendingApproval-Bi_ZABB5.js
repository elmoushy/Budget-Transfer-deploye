import{d as _e,u as he,r as l,o as fe,w as G,y as A,e as u,f as e,h as p,t as o,G as f,b as z,l as M,v as J,I as O,F as be,C as ge,n as v,J as me,i as ke,X as ye,T as Ce,m as Q,q as d,s as we}from"./index-DKx7ZiZy.js";import{T as U,S as je}from"./TransfersFlowService-CrKQ_05Z.js";import{E as xe}from"./eye-CqvhAtqx.js";import{C as Re}from"./check-D82HTsTF.js";const Pe={class:"toolbar"},Ae={class:"page-title"},Me={class:"toolbar-right"},Te={class:"search-container"},qe=["placeholder"],De={key:0,class:"selection-bar"},Se={class:"selection-info"},$e={class:"action-buttons"},Le=["disabled"],Ie=["disabled"],Be={key:1,class:"loading-container"},Ee={key:2,class:"table-container"},Ve={key:"head"},Fe={class:"checkbox-column"},Ne={class:"checkbox-container"},Ue=["checked"],He={style:{"text-align":"center"}},Ge={style:{"text-align":"center"}},ze={style:{"text-align":"center"}},Je={style:{"text-align":"center"}},Oe={style:{"text-align":"center"}},Qe={style:{"text-align":"center"}},Xe={key:"body"},Ke={class:"checkbox-column"},We={class:"checkbox-container"},Ye=["onChange","checked"],Ze={class:"code-cell"},et={class:"action-buttons-cell"},tt=["onClick"],at=["onClick"],st=["onClick"],ot={key:"no-results"},nt={colspan:"7",class:"no-results"},lt={class:"pagination"},ct=["disabled"],rt={class:"page-info"},it=["disabled"],ut={class:"modal-header"},dt={class:"modal-body"},vt={key:0,class:"reason-container"},pt={for:"rejection-reason",class:"reason-label"},_t=["placeholder"],ht={key:0,class:"reason-error"},ft={class:"modal-footer"},bt=["disabled"],gt={class:"modal-header"},mt={class:"modal-body"},kt={class:"modal-footer"},X=10,yt=_e({name:"ContractsPendingApprovalPage",__name:"ContractsPendingApproval",setup(Ct){const w=he(),s=l(!1),b=l(!1);fe(()=>{s.value=w.language==="ar",b.value=w.darkMode,_()}),G(()=>w.language,a=>s.value=a==="ar"),G(()=>w.darkMode,a=>b.value=a);const K={stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"},W={stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},g=A(()=>s.value?W:K),T=l([]),q=l(0),D=l(!1),j=l(!1),S=l(""),x=l(!1);function Y(a){return{pending:s.value?"قيد الانتظار":"Pending","under-review":s.value?"قيد المراجعة":"Under Review",approved:s.value?"تمت الموافقة":"Approved",rejected:s.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function Z(a){try{const t=new Date(a);return new Intl.DateTimeFormat(s.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}const c=l([]),ee=A(()=>y.value.length>0&&c.value.length===y.value.length);function $(a){return c.value.some(t=>t.transaction_id===a.transaction_id)}function te(a){$(a)?c.value=c.value.filter(t=>t.transaction_id!==a.transaction_id):c.value.push(a)}function ae(a){a.target.checked?c.value=[...y.value]:c.value=[]}function se(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const m=l(""),r=l(1),L=l(null);function oe(){L.value&&clearTimeout(L.value),L.value=window.setTimeout(()=>{r.value=1,_()},500)}function ne(){m.value="",r.value=1,_()}async function _(){try{D.value=!0;const a=await U.fetchPendingTransfers(r.value,X,m.value,"FAD");T.value=(a.results||[]).map(t=>({transaction_id:t.id||t.transaction_id,status:t.status,code:t.code,request_date:t.request_date,requested_by:t.requested_by,transaction_date:t.transaction_date,...t})),q.value=a.count||0,c.value=[]}catch(a){console.error("Failed to load transfers:",a),S.value=s.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",x.value=!0,T.value=[],q.value=0}finally{D.value=!1}}function le(){r.value<k.value&&(r.value++,_())}function ce(){r.value>1&&(r.value--,_())}const k=A(()=>Math.ceil(q.value/X)),y=A(()=>T.value);function re(a){console.log("View details for row:",a.transaction_id)}function ie(a){R("approve",[a])}function ue(a){R("reject",[a])}function de(){R("approve",c.value)}function ve(){R("reject",c.value)}const I=l(!1),h=l("approve"),B=l(""),E=l(""),H=l([]),C=l(""),V=l(!1);function R(a,t){h.value=a,H.value=t,C.value="",V.value=!1;const i=t.length;a==="approve"?(B.value=s.value?"تأكيد الموافقة":"Confirm Approval",E.value=s.value?`هل أنت متأكد من موافقتك على ${i} من المناقلات؟`:`Are you sure you want to approve ${i} transfer request${i===1?"":"s"}?`):(B.value=s.value?"تأكيد الرفض":"Confirm Rejection",E.value=s.value?`هل أنت متأكد من رفضك لـ ${i} من المناقلات؟`:`Are you sure you want to reject ${i} transfer request${i===1?"":"s"}?`),I.value=!0}async function pe(){if(h.value==="reject"&&!C.value.trim()){V.value=!0;return}try{j.value=!0;const a=h.value,i=H.value.map(n=>n.transaction_id);if(a==="approve")await U.approveRejectTransfers(i,2);else{const n=i.map(()=>C.value.trim());await U.approveRejectTransfers(i,3,n)}await _(),P()}catch(a){console.error("Error processing action:",a),S.value=s.value?"حدث خطأ أثناء معالجة الإجراء. يرجى المحاولة مرة أخرى.":"An error occurred while processing your action. Please try again.",x.value=!0}finally{j.value=!1}}function P(){I.value=!1}function F(){x.value=!1}return(a,t)=>{const i=me("router-link");return d(),u("div",{class:v(["approval-page",{"dark-mode":b.value}])},[e("div",Pe,[e("h1",Ae,o(s.value?"المناقلات قيد الاعتماد":"Transfers Pending Approval"),1),e("div",Me,[e("div",Te,[f(M(je),{class:"search-icon"}),z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>m.value=n),type:"search",placeholder:s.value?"بحث...":"Search...",class:"input-search",onInput:oe},null,40,qe),[[J,m.value]]),m.value?(d(),u("button",{key:0,onClick:ne,class:"clear-search"},"×")):p("",!0)])])]),c.value.length>0?(d(),u("div",De,[e("span",Se,o(s.value?`تم اختيار ${c.value.length} عنصر`:`${c.value.length} items selected`),1),e("div",$e,[e("button",{onClick:ve,class:"btn-reject",disabled:c.value.length===0},o(s.value?"رفض":"Reject"),9,Le),e("button",{onClick:de,class:"btn-approve",disabled:c.value.length===0},o(s.value?"موافقة":"Approve"),9,Ie)])])):p("",!0),D.value?(d(),u("div",Be,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,o(s.value?"جاري التحميل...":"Loading..."),1)])):(d(),u("div",Ee,[f(Ce,{name:"table-fade",tag:"table",class:"main-table"},{default:O(()=>[e("thead",Ve,[e("tr",null,[e("th",Fe,[e("label",Ne,[e("input",{type:"checkbox",onChange:ae,checked:ee.value},null,40,Ue),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",He,o(g.value.stateLevel),1),e("th",Ge,o(g.value.code),1),e("th",ze,o(g.value.requestDate),1),e("th",Je,o(g.value.requestedBy),1),e("th",Oe,o(g.value.transactionDate),1),e("th",Qe,o(s.value?"إجراءات":"Actions"),1)])]),e("tbody",Xe,[(d(!0),u(be,null,ge(y.value,n=>(d(),u("tr",{key:n.transaction_id,class:v([[se(n.status),{"row-selected":$(n)}],"table-row"])},[e("td",Ke,[e("label",We,[e("input",{type:"checkbox",onChange:N=>te(n),checked:$(n)},null,40,Ye),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,[e("span",{class:v(["status-badge","status-"+n.status.toLowerCase()])},o(Y(n.status)),3)]),e("td",Ze,[f(i,{to:`/cost-center-transfer/${n.transaction_id}?viewOnly=true`,class:"code-link"},{default:O(()=>[ke(o(n.code),1)]),_:2},1032,["to"])]),e("td",null,o(Z(n.request_date)),1),e("td",null,o(n.requested_by),1),e("td",null,o(n.transaction_date),1),e("td",null,[e("div",et,[e("button",{class:"icon-btn view-btn",onClick:N=>re(n),title:"View Details"},[f(M(xe))],8,tt),e("button",{class:"icon-btn approve-btn",onClick:N=>ie(n),title:"Approve"},[f(M(Re))],8,at),e("button",{class:"icon-btn reject-btn",onClick:N=>ue(n),title:"Reject"},[f(M(ye))],8,st)])])],2))),128)),y.value.length===0?(d(),u("tr",ot,[e("td",nt,o(s.value?"لا توجد نتائج":"No results found"),1)])):p("",!0)])]),_:1})])),e("div",lt,[e("button",{onClick:ce,class:v(["page-btn",{disabled:r.value===1}]),disabled:r.value===1},o(s.value?"السابق":"Previous"),11,ct),e("span",rt,o(s.value?`صفحة ${r.value} من ${k.value}`:`Page ${r.value} of ${k.value}`),1),e("button",{onClick:le,class:v(["page-btn",{disabled:r.value>=k.value}]),disabled:r.value>=k.value},o(s.value?"التالي":"Next"),11,it)]),I.value?(d(),u("div",{key:3,class:"modal-overlay",onClick:P},[e("div",{class:v(["modal-container",{"dark-mode":b.value}]),onClick:t[2]||(t[2]=Q(()=>{},["stop"]))},[e("div",ut,[e("h2",null,o(B.value),1),e("button",{class:"close-modal",onClick:P},"×")]),e("div",dt,[e("p",null,o(E.value),1),h.value==="reject"?(d(),u("div",vt,[e("label",pt,o(s.value?"سبب الرفض:":"Rejection Reason:"),1),z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),placeholder:s.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,_t),[[J,C.value]]),V.value?(d(),u("p",ht,o(s.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):p("",!0)])):p("",!0)]),e("div",ft,[e("button",{class:"btn-secondary",onClick:P},o(s.value?"إلغاء":"Cancel"),1),e("button",{class:v(h.value==="approve"?"btn-approve":"btn-reject"),onClick:pe,disabled:j.value},o(j.value?s.value?"جاري المعالجة...":"Processing...":h.value==="approve"?s.value?"موافقة":"Approve":s.value?"رفض":"Reject"),11,bt)])],2)])):p("",!0),x.value?(d(),u("div",{key:4,class:"modal-overlay",onClick:F},[e("div",{class:v(["modal-container error-modal",{"dark-mode":b.value}]),onClick:t[3]||(t[3]=Q(()=>{},["stop"]))},[e("div",gt,[e("h2",null,o(s.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:F},"×")]),e("div",mt,[e("p",null,o(S.value),1)]),e("div",kt,[e("button",{class:"btn-secondary",onClick:F},o(s.value?"إغلاق":"Close"),1)])],2)])):p("",!0)],2)}}}),Pt=we(yt,[["__scopeId","data-v-fe15337b"]]);export{Pt as default};
