import{c as Se,a as J,s as W,d as je,u as De,x as _,I as $e,r,o as Te,w as Y,e as c,f as e,h as g,t as n,D as T,b as Z,l as U,v as ee,F as te,B as ae,n as y,H as xe,i as Be,K as Le,X as Me,m as se,p as Ee,q as u,_ as Ue}from"./index-wslj3pDp.js";import{E as Ve}from"./eye-CQn8q19O.js";import{C as Fe}from"./check-D0POaKHg.js";/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Se("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),oe="https://lightidea.org:9000/",ne={async fetchPendingTransfers(C=1,f=10,w="",b=""){const h=J();if(!h.token)throw new Error("Authentication token not found");try{return(await W.get(`${oe}/api/budget/transfers/list_underapprovel/`,{headers:{Authorization:`Bearer ${h.token}`},params:{page:C,page_size:f,code:b,search:w.trim()}})).data}catch(v){throw console.error("Error fetching transfers pending approval:",v),v}},async approveRejectTransfers(C,f,w=[]){const b=J();if(!b.token)throw new Error("Authentication token not found");try{return(await W.post(`${oe}/api/budget/transfers/adjd-approve-reject/`,{transaction_id:C,decide:C.map(()=>f),reason:w.length?w:C.map(()=>"")},{headers:{Authorization:`Bearer ${b.token}`}})).data}catch(h){throw console.error("Error approving/rejecting transfers:",h),h}}},Ne={class:"toolbar"},ze={class:"page-title"},He={class:"toolbar-right"},Ke={class:"search-container"},Oe=["placeholder"],Qe={key:0,class:"selection-bar"},Xe={class:"selection-info"},Ge={class:"action-buttons"},Je=["disabled"],We=["disabled"],Ye={key:1,class:"loading-container"},Ze={key:2,class:"table-container glass-panel"},et={class:"modern-table-wrapper"},tt={class:"modern-table"},at={class:"table-header"},st={class:"checkbox-column"},ot={class:"checkbox-container"},nt=["checked"],lt={class:"th-status"},rt={class:"th-code"},it={class:"th-request-date"},ct={class:"th-requested-by"},ut={class:"th-transaction-date"},dt={class:"th-actions"},vt={class:"checkbox-column"},pt={class:"checkbox-container"},ht=["onChange","checked"],_t={class:"td-status"},gt={class:"td-code"},ft={class:"td-request-date"},bt={class:"td-requested-by"},mt={class:"td-transaction-date"},kt={class:"td-actions"},yt={class:"action-buttons-group"},Ct=["onClick"],wt=["onClick"],Pt=["onClick"],At={key:"no-results"},qt={colspan:"7",class:"no-results"},Rt={key:3,class:"pagination-wrapper glass-panel"},St={class:"pagination-info"},jt={class:"pagination-text"},Dt={class:"pagination-controls"},$t=["disabled"],Tt=["disabled"],xt={class:"page-numbers"},Bt=["onClick","disabled"],Lt=["disabled"],Mt=["disabled"],Et={class:"modal-header"},Ut={class:"modal-body"},Vt={key:0,class:"reason-container"},Ft={for:"rejection-reason",class:"reason-label"},It=["placeholder"],Nt={key:0,class:"reason-error"},zt={class:"modal-footer"},Ht=["disabled"],Kt={class:"modal-header"},Ot={class:"modal-body"},Qt={class:"modal-footer"},S=10,Xt=je({name:"PendingApprovalPage",__name:"UnifiedPendingApproval",setup(C){const f=$e(),w=Ee(),b=De(),h={EnhancementsPendingApproval:{title:{ar:"المناقلات قيد الاعتماد",en:"Transfers Pending Approval"},apiCode:"FAR",detailRoute:"/cost-center-transfer/:id?viewOnly=true",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},ContractsPendingApproval:{title:{ar:"العقود قيد الاعتماد",en:"Contracts Pending Approval"},apiCode:"FAD",detailRoute:"/contracts/:id",showViewButton:!0,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},SettlementsPendingApproval:{title:{ar:"التسويات قيد الاعتماد",en:"Settlements Pending Approval"},apiCode:"AFR",detailRoute:"/settlements/:id",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}}},v=_(()=>h[f.name]||h.EnhancementsPendingApproval),o=_(()=>b.language==="ar"),V=_(()=>b.darkMode),le=_(()=>o.value?v.value.title.ar:v.value.title.en),j=_(()=>o.value?v.value.headers.ar:v.value.headers.en),D=r([]),k=r(0),x=r(!1),B=r(!1),F=r(""),L=r(!1);function re(a){return{pending:o.value?"قيد الانتظار":"Pending","under-review":o.value?"قيد المراجعة":"Under Review",approved:o.value?"تمت الموافقة":"Approved",rejected:o.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function ie(a){try{const t=new Date(a);return new Intl.DateTimeFormat(o.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}function X(a){return v.value.detailRoute.replace(":id",a.transaction_id.toString())}const i=r([]),ce=_(()=>q.value.length>0&&i.value.length===q.value.length);function I(a){return i.value.some(t=>t.transaction_id===a.transaction_id)}function ue(a){I(a)?i.value=i.value.filter(t=>t.transaction_id!==a.transaction_id):i.value.push(a)}function de(a){a.target.checked?i.value=[...q.value]:i.value=[]}function ve(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const P=r(""),l=r(1),N=r(null);function pe(){N.value&&clearTimeout(N.value),N.value=window.setTimeout(()=>{l.value=1,p()},500)}function he(){P.value="",l.value=1,p()}async function p(){try{x.value=!0,console.log(`[UnifiedPendingApproval] Loading data for route: ${String(f.name)}, API code: ${v.value.apiCode}`);const a=await ne.fetchPendingTransfers(l.value,S,P.value,v.value.apiCode);console.log("[UnifiedPendingApproval] API Response:",a),f.name==="ContractsPendingApproval"?(console.log("[UnifiedPendingApproval] Using Contracts field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.code||""),request_date:String(t.request_date||""),requested_by:String(t.requested_by||""),transaction_date:String(t.transaction_date||"")}))):(console.log("[UnifiedPendingApproval] Using Transfers/Settlements field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.transfer_id||t.code||""),request_date:String(t.created_at||t.request_date||""),requested_by:String(t.user_name||t.requested_by||""),transaction_date:String(t.updated_at||t.transaction_date||"")}))),console.log("[UnifiedPendingApproval] Mapped rows:",D.value),k.value=a.count||0,i.value=[]}catch(a){console.error("Failed to load transfers:",a),F.value=o.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",L.value=!0,D.value=[],k.value=0}finally{x.value=!1}}function _e(){l.value<A.value&&(l.value++,p())}function ge(){l.value>1&&(l.value--,p())}function fe(){l.value=1,p()}function be(){l.value=A.value,p()}function me(a){a>=1&&a<=A.value&&a!==-1&&(l.value=a,p())}const A=_(()=>Math.ceil(k.value/S)),ke=_(()=>{const a=[],t=A.value,d=l.value;if(t<=7)for(let s=1;s<=t;s++)a.push(s);else if(a.push(1),d<=4){for(let s=2;s<=5;s++)a.push(s);a.push(-1),a.push(t)}else if(d>=t-3){a.push(-1);for(let s=t-4;s<=t;s++)a.push(s)}else{a.push(-1);for(let s=d-1;s<=d+1;s++)a.push(s);a.push(-1),a.push(t)}return a}),q=_(()=>D.value);function ye(a){const t=X(a);w.push(t)}function Ce(a){M("approve",[a])}function we(a){M("reject",[a])}function Pe(){M("approve",i.value)}function Ae(){M("reject",i.value)}const z=r(!1),m=r("approve"),H=r(""),K=r(""),G=r([]),$=r(""),O=r(!1);function M(a,t){m.value=a,G.value=t,$.value="",O.value=!1;const d=t.length;a==="approve"?(H.value=o.value?"تأكيد الموافقة":"Confirm Approval",K.value=o.value?`هل أنت متأكد من موافقتك على ${d} من المناقلات؟`:`Are you sure you want to approve ${d} transfer request${d===1?"":"s"}?`):(H.value=o.value?"تأكيد الرفض":"Confirm Rejection",K.value=o.value?`هل أنت متأكد من رفضك لـ ${d} من المناقلات؟`:`Are you sure you want to reject ${d} transfer request${d===1?"":"s"}?`),z.value=!0}function E(){z.value=!1}function Q(){L.value=!1}async function qe(){if(m.value==="reject"&&!$.value.trim()){O.value=!0;return}try{B.value=!0;const a=G.value.map(Re=>Re.transaction_id),t=m.value==="approve"?2:3,d=m.value==="reject"?a.map(()=>$.value.trim()):[];await ne.approveRejectTransfers(a,t,d),await p(),E();const s=m.value==="approve"?o.value?"الموافقة":"approval":o.value?"الرفض":"rejection",R=o.value?`تم ${s} بنجاح`:`${s.charAt(0).toUpperCase()+s.slice(1)} successful`;console.log(R)}catch(a){console.error("Error processing action:",a),F.value=o.value?"حدث خطأ أثناء معالجة الطلب. يرجى المحاولة مرة أخرى.":"An error occurred while processing the request. Please try again.",L.value=!0}finally{B.value=!1}}return Te(()=>{p()}),Y(()=>f.name,()=>{l.value=1,P.value="",i.value=[],p()}),Y(()=>b.language,()=>{p()}),(a,t)=>{const d=Le("router-link");return u(),c("div",{class:y(["approval-page",{"dark-mode":V.value}])},[e("div",Ne,[e("h1",ze,n(le.value),1),e("div",He,[e("div",Ke,[T(U(Ie),{class:"search-icon"}),Z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>P.value=s),type:"search",placeholder:o.value?"بحث...":"Search...",class:"input-search",onInput:pe},null,40,Oe),[[ee,P.value]]),P.value?(u(),c("button",{key:0,onClick:he,class:"clear-search"},"×")):g("",!0)])])]),i.value.length>0?(u(),c("div",Qe,[e("span",Xe,n(o.value?`تم اختيار ${i.value.length} عنصر`:`${i.value.length} items selected`),1),e("div",Ge,[e("button",{onClick:Ae,class:"btn-reject",disabled:i.value.length===0},n(o.value?"رفض":"Reject"),9,Je),e("button",{onClick:Pe,class:"btn-approve",disabled:i.value.length===0},n(o.value?"موافقة":"Approve"),9,We)])])):g("",!0),x.value?(u(),c("div",Ye,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,n(o.value?"جاري التحميل...":"Loading..."),1)])):(u(),c("div",Ze,[e("div",et,[e("table",tt,[e("thead",null,[e("tr",at,[e("th",st,[e("label",ot,[e("input",{type:"checkbox",onChange:de,checked:ce.value},null,40,nt),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",lt,n(j.value.stateLevel),1),e("th",rt,n(j.value.code),1),e("th",it,n(j.value.requestDate),1),e("th",ct,n(j.value.requestedBy),1),e("th",ut,n(j.value.transactionDate),1),e("th",dt,n(o.value?"إجراءات":"Actions"),1)])]),e("tbody",null,[(u(!0),c(te,null,ae(q.value,s=>(u(),c("tr",{key:s.transaction_id,class:y([ve(s.status),{"row-selected":I(s)},"table-row"])},[e("td",vt,[e("label",pt,[e("input",{type:"checkbox",onChange:R=>ue(s),checked:I(s)},null,40,ht),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",_t,[e("span",{class:y(["status-badge","status-"+s.status.toLowerCase()])},n(re(s.status)),3)]),e("td",gt,[T(d,{to:X(s),class:"code-link"},{default:xe(()=>[Be(n(s.code),1)]),_:2},1032,["to"])]),e("td",ft,n(ie(s.request_date)),1),e("td",bt,n(s.requested_by),1),e("td",mt,n(s.transaction_date),1),e("td",kt,[e("div",yt,[v.value.showViewButton?(u(),c("button",{key:0,class:"action-btn view-btn",onClick:R=>ye(s),title:"View"},[T(U(Ve))],8,Ct)):g("",!0),e("button",{class:"action-btn approve-btn",onClick:R=>Ce(s),title:"Approve"},[T(U(Fe))],8,wt),e("button",{class:"action-btn reject-btn",onClick:R=>we(s),title:"Reject"},[T(U(Me))],8,Pt)])])],2))),128)),q.value.length===0?(u(),c("tr",At,[e("td",qt,n(o.value?"لا توجد نتائج":"No results found"),1)])):g("",!0)])])])])),!x.value&&q.value.length>0?(u(),c("div",Rt,[e("div",St,[e("span",jt,n(o.value?`عرض ${(l.value-1)*S+1} إلى ${Math.min(l.value*S,k.value)} من ${k.value} عنصر`:`Showing ${(l.value-1)*S+1} to ${Math.min(l.value*S,k.value)} of ${k.value} items`),1)]),e("div",Dt,[e("button",{class:"pagination-btn pagination-btn-first",onClick:fe,disabled:l.value===1,title:"First Page"}," ⟪ ",8,$t),e("button",{class:"pagination-btn pagination-btn-prev",onClick:ge,disabled:l.value===1,title:"Previous Page"}," ⟨ ",8,Tt),e("div",xt,[(u(!0),c(te,null,ae(ke.value,s=>(u(),c("button",{key:s,class:y(["pagination-btn page-number",{active:s===l.value,ellipsis:s===-1}]),onClick:R=>me(s),disabled:s===-1},n(s===-1?"...":s),11,Bt))),128))]),e("button",{class:"pagination-btn pagination-btn-next",onClick:_e,disabled:l.value>=A.value,title:"Next Page"}," ⟩ ",8,Lt),e("button",{class:"pagination-btn pagination-btn-last",onClick:be,disabled:l.value>=A.value,title:"Last Page"}," ⟫ ",8,Mt)])])):g("",!0),z.value?(u(),c("div",{key:4,class:"modal-overlay",onClick:E},[e("div",{class:y(["modal-container",{"dark-mode":V.value}]),onClick:t[2]||(t[2]=se(()=>{},["stop"]))},[e("div",Et,[e("h2",null,n(H.value),1),e("button",{class:"close-modal",onClick:E},"×")]),e("div",Ut,[e("p",null,n(K.value),1),m.value==="reject"?(u(),c("div",Vt,[e("label",Ft,n(o.value?"سبب الرفض:":"Rejection Reason:"),1),Z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),placeholder:o.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,It),[[ee,$.value]]),O.value?(u(),c("p",Nt,n(o.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):g("",!0)])):g("",!0)]),e("div",zt,[e("button",{class:"btn-secondary",onClick:E},n(o.value?"إلغاء":"Cancel"),1),e("button",{class:y(m.value==="approve"?"btn-approve":"btn-reject"),onClick:qe,disabled:B.value},n(B.value?o.value?"جاري المعالجة...":"Processing...":m.value==="approve"?o.value?"موافقة":"Approve":o.value?"رفض":"Reject"),11,Ht)])],2)])):g("",!0),L.value?(u(),c("div",{key:5,class:"modal-overlay",onClick:Q},[e("div",{class:y(["modal-container error-modal",{"dark-mode":V.value}]),onClick:t[3]||(t[3]=se(()=>{},["stop"]))},[e("div",Kt,[e("h2",null,n(o.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:Q},"×")]),e("div",Ot,[e("p",null,n(F.value),1)]),e("div",Qt,[e("button",{class:"btn-secondary",onClick:Q},n(o.value?"إغلاق":"Close"),1)])],2)])):g("",!0)],2)}}}),Yt=Ue(Xt,[["__scopeId","data-v-3ba4a6d4"]]);export{Yt as default};
